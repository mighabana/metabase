## Technical Overview

This Metabase implementation extends Metabase's docker image by utilizing it in conjunction with `nginx` and `certbot` to make it easy to deploy in production. These two additional tools allow metabase to be securely accessed via HTTPS by setting up the routing and obtaining the SSL certificates needed for that setup.

**Metabase Instance**

- The Metabase instance is setup to connect to a PostgreSQL database to use as its operational database. In order to connect to the proper database you can set the database connection parameters via environment variables.
- The instance uses the host network to ensure that all ports are exposed as needed. This was done to make implementation on a cloud server easier.

**NGINX and Certbot**
- The configurations and necessary files for both NGINX and Certbot are accessible through docker volumes to ensure that the files are easy to monitor and debug.
    - The specific files that are exposed are the nginx configs, and the SSL certificates generated by Certbot.
    - The repository is setup so that these files will not be saved on commit.

## Prerequisites

- [Docker](https://docs.docker.com/get-docker/) installed
- [Docker Compose](https://docs.docker.com/compose/install/) installed
- A postgres database and user to be used as Metabase's operational database
- Sufficient privileges to run Docker commands (e.g., being part of the `docker` user group or having root access)

## Getting Started

1. **Clone the Repository:**
    ```bash
    git clone git@github.com:mighabana/metabase.git
    cd metabase
    ```
2. **Setup Environment Variables**
    ```bash
    export MB_DB_HOST=your_metabase_database_host_address
    export MB_DB_DBNAME=your_metabase_database_name
    export MB_DB_PORT=your_metabase_database_port
    export MB_DB_USER=your_metabase_database_username
    export MB_DB_PASS=your_metabase_database_password
    export MB_ENCRYPTION_SECRET_KEY=your_metabase_encryption_secret_key
    ```

    - for more information regarding the encryption secret key you can check metabase's documentation for it [here](https://www.metabase.com/docs/latest/databases/encrypting-details-at-rest)
3. **Run the Docker Compose containers**
    ```bash
    docker compose up -d
    ```
4. **(optional) Setup the SSL certificates**

    If you are deploying the instance on a Virtual Machine and want it to be accessible over the internet you need to run the `init-letsencrypt.sh` file.

    **Note:** before running you may want to update some values in the script such as the `email` and `domain` to suit your needs.

    ```bash
    sh init-letsencrypt.sh
    ```
